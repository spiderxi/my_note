# 概念

## Redis为什么快?

```
1. 使用内存存储
2. 单线程避免了并发控制上锁和多线程之间的上下文切换
3. 使用多路复用io, 使用epoll系统调用
```

## 缓存三大问题

![1681289687746](image/redis/1681289687746.png)


bloom filter原理

```
通过多个hash函数映射到bitmap的不同位置为1, 查询时如果有一个位置不是1则肯定不存在
```



## 缓存和数据库一致性问题

当数据库数据更新时, 缓存不会立刻更新, 会导致数据库和缓存不一致问题, 所以需要**更新数据库时需要删除缓存**

先删除缓存还是先更新数据库?

```
一般先更新数据库, 先删除缓存可能导致更新数据库期间, 读线程读取了脏数据到缓存中
先更新数据库缓存是脏数据的可能性小
```

先更新数据库一定不会发生不一致问题吗?

```
不一定, 如果在更新数据库期间, 缓存恰好失效, 读线程读取了数据库中的旧数据, 然后写入缓存在更新线程删除缓存之后, 就会不一致

解决方法为更新线程在删除缓存后, 将第二次删除缓存放到mq中, 延迟一顿时间后再次删除缓存
```

## Redis并发

redis如何保证高并发下不会出错

```
1. redis单线程, 且incr, decr等api是原子的
2. 可以使用分布式锁保障并发原子性
```

# Redis集群

## 主从+哨兵集群

```
1. 主服务器负责写请求, 从服务器负责读请求
2. 主从服务器刚连接时进行一次全量复制, 当主服务器进行写时, 从服务器进行一次增量复制
3. 使用多个哨兵服务器监测所有服务器的状态, 如果多个哨兵认为某台服务器不可用则该服务器被移除集群, 如果主服务器不可用会从从服务器中重新选举主服务器
```

## Cluster

redis cluster本质上是多个主节点之间集群, 各个主节点之间保存数据的分片和副本, 通过冗余的方式来保障服务的高可用性

负载均衡算法使用一致性哈希算法, 一致性hash算法可以避免集群扩容时发生大量数据迁移

# 情景

## 如何实现排行榜?

使用zset, score根据比较字段优先级, 优先级高的字段占据高位

## 热点数据在单机如何优化?

将热点数据的key末尾添加随机数, 实现将相同的热点数据放到不同的服务器上
