# 1. The Internt

## 1.1 OSI七层和TCP/IP五层

![1680253774485](image/计算机网络/1680253774485.png)

![1690949472193](image/计算机网络/1690949472193.png)

***每一层常见的协议有哪些?***

```
应用层: HTTP FTP DNS SSH
传输层: TCP UDP
网络层: IP ICMP ARP(TCP/IP模型中ARP协议属于网络层)
链路层: ARP(OSI模型中ARP协议属于链路层)
```

***每层协议由谁进行处理?***

```
应用层: 应用程序
传输层: 操作系统
网络层: 操作系统
链路层: 交换机/网卡
```

## 1.2 网络传输方式

***为什么有MAC地址还要有IP地址, 可以只是用MAC地址/IP地址吗?***

```
* MAC地址相当于网卡的UUID, 用于局域网中设备区分
* IP地址需要设备连接到子网后才会被分配(如DHCP协议), 用于路由器路由报文到对应子网

只使用Mac地址会导致路由器路由表非常大而且效率低(MAC地址是UUID, 无法根据地区划分)
只使用IP地址在设备联网之前无法分辨设备
```

***带宽和吞吐量的区别?***

```
带宽是指网络线路单位时间内传输数据的速度, 单位bit/s

吞吐量是指实际往网络中传输数据的速度, <= 带宽, 受网络拥塞状况影响
```

## 1.3 网络中的设备

***网络中的主要设备和作用?***

* 网卡: 负责计算机和链路的数据转发, **每个网卡有唯一的MAC地址**
* 中继器/集线器: 只负责放大和转发信号, **集线器由多个中继器构成**

![1690954673301](image/计算机网络/1690954673301.png)

* 交换机: **自动学习MAC地址-端口表**, 通过MAC地址-端口表转发数据帧, 将一个局域网划分成多个虚拟局域网VLAN, **将LAN广播域划分为更小的VLAN的广播域**

> 交换机在收到发送到未知MAC地址的数据帧时, 会广播数据帧

* 路由器: **动态维护路由表, 根据路由表中的IP地址转发报文到其他局域网/广域网**

> 路由器在收到发送到路由表中没有的IP地址的报文时, 可能会丢弃报文或发送到默认网关

* 网关: 负载均衡,  安全控制

![1690954573480](image/计算机网络/1690954573480.png)

## 1.5 常用的应用层协议

***说几种常见的应用层协议?***

```
* http
* dns-域名解析
* ssh-远程登录
* ftp
* smtp
```

# 2. HTTP协议

## 2.1 HTTP简介

***HTTP协议基于哪些协议?***

```
* TCP: 提供可靠的字节流通信服务
* IP: 提供主机到主机的通信服务
* DNS: 提供域名到IP的映射服务
* ARP: 提供IP地址转为MAC地址服务
```

***URL和URI是什么?***

```
URI: 用一串字符串标识任何一个资源
URL: 用一串字符串标识互联网上的任何一个资源, URL是URI的子集
```

***讲一下URI的格式?***

![1690448851844](image/计算机网络/1690448851844.png)

## 2.2 HTTP/1.1

### 2.2.1 请求报文

***讲一下请求报文和响应报文的格式?***

请求报文

![1690449513227](image/计算机网络/1690449513227.png)

响应报文

![1690449547645](image/计算机网络/1690449547645.png)

### 2.2.2 请求方法

***常用的请求方法的含义?***

```
GET: 获取服务器资源
POST: 往服务器新增资源
PUT: 往服务器更新资源(如果之前不存在则新增)
DELETE: 删除服务器资源
OPTIONS: 询问服务器支持哪些的通信选项(支持的请求方法, 是否允许跨域...)
```

***GET请求和POST请求的区别?***

```
GET: 一般忽略请求体, 使用query参数, url长度有限制, 有幂等性(多次请求对服务器没有副作用)
POST: 与上述相反, 参数通过query参数和请求体传送
```

### 2.2.3 长连接

***什么是HTTP长连接?***

```
Http1.0版本中, 每发送一次http请求都需要建立/释放一次TCP连接
Htpp1.1中, 提出了长连接(请求头keep-alive字段), 支持多个http请求使用一个TCP连接, 这些请求之间以管道的形式发送到服务器
```

![1690782326049](image/计算机网络/1690782326049.png)

### 2.2.4 cookie/session/jwt

***什么是cookie?***

```
* cookie是被浏览器保存的键值对
* cookie有作用域名和过期时间
* 浏览器请求时会自动携带cookie
* cookie过期时间为session时关闭页面后失效, 否则按照过期时间计算是否失效
* 服务器在响应头中使用Set-Cookie来让浏览器保存cookie
```

***cookie和session的区别?***

```
* cookie是由浏览器保存的键值对, session由服务端保存的用户会话信息对象
* session通过session_id标识, 服务器通过cookie的方式发送session_id给客户端
* cookie可以跨域使用, session不可跨域
```

***jwt是什么, 由哪三部分组成?***

```
jwt是使用加密算法生成的身份令牌, 保存在浏览器的localStorage中, 发送请求时可在请求头中带上jwt用于身份认证

组成: jwt元信息的BASE64编码.jwt载荷的BASE64编码.使用私钥生成的数字签名
```

### 2.2.5 常用头部字段

请求头和响应头通用字段

| key           | 含义                            | 示例                                            |
| ------------- | ------------------------------- | ----------------------------------------------- |
| Cache-Control | 希望如何缓存响应内容            | Cache-Control: max-age=604800（                 |
| Connection    | 关闭和开启长连接 / 请求升级协议 | Connection: Keep-Alive<br />Connection: Upgrade |
| Upgrade       | 指定希望升级的协议              | Upgrade: TLS/1.0                                |

请求头使用的字段

| key           | 含义                               |
| ------------- | ---------------------------------- |
| Accept-Xxx    | 请求方支持的文件格式/编码/压缩方式 |
| Cookie        | 告诉服务器客户端有哪些cookie       |
| Authorization | 认证信息                           |
| Referer       | 请求是从哪里链接过来的             |
| User-Agent    | 浏览器信息                         |

响应头使用的字段

| key         | 含义               |
| ----------- | ------------------ |
| Location    | 重定向后的地址     |
| Retry-After | 多久后让请求方重试 |
| Set-Cookie  | 让客户端设置cookie |

请求头/响应头中的补充字段

| key           | 含义                             |
| ------------- | -------------------------------- |
| Allow         | 服务器允许的请求方法             |
| Content-Xxx   | 负载的格式/压缩方式/长度         |
| Expires       | 内容过期时间(搭配缓存使用)       |
| Last-Modified | 内容上一次修改时间(搭配缓存使用) |

### 2.2.6 响应码

```
200: 请求成功
301: 永久重定向
302: 临时重定向
304: 缓存未更新
400: 请求报文有语法错误
401: 未认证
403: 未授权
404: 找不到资源
405: 请求方法不允许
500: 服务器内部错误
```

## 2.3 各版本的HTTP

***http1.1相较于http1.0有哪些改进?***

```
* 长连接keep-alive: 复用TCP通道
* 缓存控制cache-control
```

***http2.0相较于http1.1有哪些改进?***

* **多路复用解决长连接中的队头阻塞问题**
* 请求头压缩
* 服务器主动推送

***什么是队头阻塞问题, HTTP2.0如何解决?***

```
http1.1长连接中, 管道中前一个请求报文延迟会导致长连接中后面请求都延迟

http2.0将报文分成更小单位帧(fream)并行传输, 帧使用id标识顺序, 从而实现多路复用解决队头阻塞问题
```

***Http3.0特点?***

HTTP/3.0使用QUIC作为传输协议, QUIC是基于UDP的协议

## 2.4 HTTPS

***Https和http协议的区别?***

https是基于http协议的, 在http的基础上对http报文使用SSL协议进行加密

![1690789057564](image/计算机网络/1690789057564.png)

***什么是数字签名?***

数字签名用来确保发送数据的完整性和证实发送方的身份, 数字签名的使用过程如下

![1690790100693](image/计算机网络/1690790100693.png)

***什么是数字证书?***

数字证书是由数字证书认证机构(CA)颁布的证书, 证书中包含服务器的信息(包含服务器的公钥)以及使用CA机构私钥生成的数字签名

客户端在获取到数字证书后, 可以通过浏览器里的CA机构的公钥验证证书的有效性, 从而获取到服务器的公钥

![1690790307045](image/计算机网络/1690790307045.png)

***讲一下HTTPS协议握手过程?***

![1690791342181](image/计算机网络/1690791342181.png)

```
ClientHello, ServerHello: 协商需要使用的SSL/TSL加密组件
Certificate: 包含服务器公钥的数字证书
ClientKeyExchange: 使用服务器公钥加密的此次通信主密钥
```

![1690791525067](image/计算机网络/1690791525067.png)

在服务器收到通信主密钥后可以生成共享密钥, 此后使用共享密钥加密Http报文

## 2.5 WebSocket

***什么是WebSocket协议?***

websocket协议是一种**全双工通信应用层协议**, **websocket使用http协议握手**, 握手完成后使用websocket数据帧通信

***WebSocket协议握手过程?***

1. 客户端发送http连接升级请求, 在http请求头部设定特定字段
   ```http
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Protocol: chat, superchat
   Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
   Sec-WebSocket-Version: 13
   ```
2. 服务器响应升级请求
   ```http
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
   Sec-WebSocket-Protocol: chat
   ```

## 2.6 RPC

***为什么有了HTTP还要使用RPC?***

```
* HTTP传输时有很多数据冗余, 但更加通用
* RPC更适合内部的分布式系统, 可以自定义序列化来提高传输效率, 还可以实现负载均衡
```

# 3. TCP/UDP协议

## 3.1 端口号

***端口号的范围?知名端口号的范围? 常用的有哪些?***

端口号范围: 0~65535

知名端口号范围: 0~1023

常用的知名端口号

```
20/21: FTP
53: DNS
80: HTTP
443: HTTPS
3306: MYSQL
6379: Redis
8080: Tomcat
```

## 3.2 TCP的可靠通信服务

***TCP依靠什么提供可靠通信服务?***

```
* 首部校验和
* 使用seq序列号实现的报文重排序
* 使用ack响应号实现的超时重传
* 滑动窗口和流量控制
* 拥塞控制算法
```

***常见的基于TCP的应用协议和基于UDP的应用协议有哪些?***

```
TCP: HTTP FTP SSH SMTP IMAP
UDP: DNS DHCP
```

***什么是TCP粘包和拆包问题, 如果解决?***

当使用tcp发送的数据太少/太多时, tcp会将多个数据报文合并/单个报文拆分, 从而导致接收到的报文内容和期望的有差距

可以使用特殊标志位分隔开不同的数据报

***什么是nagle算法?***

```
nagle算法用于解决互联网初期小的数据包造成的网络拥塞问题

开启nagle算法后, 如果遇到小的数据包(size < MMS), 会先将其缓存, 不会立即放松, 当收到ACK报文时才会将小的数据包合并再发送

nagle算法现在默认关闭, 避免延迟
```

***可以在一个端口上同时进行TCP通信和UDP通信吗?***

```
可以, 操作系统会将TCP报文和UDP报文交给不同的模块处理
```

## 3.3 TCP三次握手四次挥手

***TCP连接建立和释放连接的过程?***

```
1. 客户端发送SYN, 请求建立连接
2. 服务器返回SYN, ACK
3. 客户端发送ACK
-----连接建立------
1. 客户端发送FIN, 表明客户端不再发送数据
2. 服务器返回ACK
---服务器完成剩余数据传输---
3. 服务器发送FIN
4. 客户端返回ACK
```

![1693627996883](image/计算机网络/1693627996883.png)

![1693628371977](image/计算机网络/1693628371977.png)

***为什么需要三次握手而不是两次?***

```
客户端发送FIN, 服务器返回ACK, 此时ACK报文丢失会导致客户端不知道服务器存在, 而服务器开启了连接, 浪费服务器资源
```

***为什么发送第四次挥手的ACK报文需要等待2*MSL(最大报文生存时间)后才正式关闭连接?***

```
防止发送的ACK报文丢失, 如果服务器重传FIN报文, 间隔时间最多为2MSL
```

## 3.4 TCP滑动窗口和拥塞控制

***什么是TCP滑动窗口?***

滑动窗口相当于一个数据缓冲, 在滑动窗口内的报文可以并发的发送, 当滑动窗口头部的报文收到应答确认后, 滑动窗口向后移动

***介绍一下快重传算法?***

在滑动窗口中, 如果发送方在**收到连续三个相同的ACK号**时, 判定该ACK对应的报文丢失, 会立刻进行重传

***介绍一下TCP中的拥塞控制和流量控制?***

```
流量控制是指接收方可以根据接收报文的速度, 设置通过TCP首部字段发送方发送窗口大小, 避免发送方发送太快

拥塞控制是指发送方有一个拥塞窗口, 拥塞窗口大小根据网络拥塞状况使用"慢启动算法"动态调整
具体来说: 拥塞窗口开始时随时间指数级增长, 当超过阈值后线性增长, 发生拥塞后阈值减半, 拥塞窗口变到最小
```

# 4. 网络层协议

## 4.1 IP协议

### 4.1.1 IP地址介绍

***什么是IP地址?***

**IP地址用于网络上数据包的路由**, 由网络号和主机号组成, IPv4地址32位, IPv6地址64位

IPv4地址使用点分十进制方式标识, 如 `127.0.0.1`

### 4.1.2 IP地址网络号

***IP地址是如何分类的?***

IP地址分为ABCDE五类, 不同类型使用不同长度的bit位前缀作为网络号

```
A类:
0.X.X.X ~ 127.X.X.X

B类:
128.0.X.X ~ 191.255.X.X

C类:
192.0.0.X ~ 223.255.225.X

D类地址作为多播地址, E类地址未使用
```

***IP地址主机号全0/全1分别表示什么?***

```
* 主机号X=0时表示网络号, 不能用于单个主机

* 主机号X=255时表示广播地址
```

***IP地址网络号如何通过子网掩码确定?***

子网掩码 & IP地址 = 得到网络号

***IP地址网络号如何通过CIDR方式确定?***

CIDR方式是指在IP地址中指明网络号的长度, 如 `178.2.36.3/16网络号长度为16, 网络号为178.2`

### 4.1.3 私有网络IP地址和NAT

***私有网络IP地址的IP地址范围是多少?***

```
A类私有地址 10.X.X.X
B类私有地址 172.16.X.X ~ 172.31.X.X
C类私有地址 192.168.X.X
```

***什么是NAT技术?***

```
* 私有网络中的主机使用私有IP地址
* 当需要连接到广域网时, 由NAT路由器完成私有IP到公有IP的映射
* 私有网络中的主机复用NAT路由器上的公网IP地址 / 公网IP地址+端口号
```

## 4.2 DNS

***域名解析过程?***

```
1. 首先查询本机缓存的hosts文件, 如果有未过期的记录解析结束, 否则继续
2. 向本地域名服务器发送解析请求(ISP提供或手动配置), 若解析失败则继续第3步
3. 本地域名服务器向配置好的顶级域名服务器发送解析请求, 然后递归请求次级域名服务器, 次次级域名服务器, 直到解析完成获取IP地址
```

***域名记录的类型常见的有哪些?***

```
域名 -> 主机IP
域名别名 -> 域名本名
邮件域名 -> 邮件服务器IP
```

## 4.3 ARP

***ARP协议是什么?***

在链路层中, 使用ARP协议来**通过IP地址获取链路中该IP地址对应的MAC地址**

```
1. 广播ARP请求报文(包含发送方MAC地址和请求的IP地址)
2. 对应IP地址的主机接受到报文后向请求方发送自己的IP地址和MAC地址
```

## 4.4 ICMP

***常见的ICMP报文类型有哪些?***

ICMP协议用于**网络诊断和监测,** 报文类型分为:

```
* 超时报文: 路由器接受到TTL=0的报文, 向源主机发送超时报文

* 不可达报文: 当路由器无法路由报文时向源主机发送ICMP不可达报文

* 回送请求报文和回送应答报文: 当目标主机收到回送请求报文时, 会向发送方发送回送应答报文 
```

## 4.5 DHCP

***DHCP协议是什么?***

DHCP协议: 主机连接到局域网后通过DHCP服务器自动进行网络配置

***使用DHCP协议自动配置的过程?***

```
1. 客户端广播DHCP发现报文
2. DHCP服务端发送可用的IP配置给客户端
3. 客户端选择一个IP配置后, 发送报文告知服务器该配置被使用
4. 客户端在IP配置将要过期时可以选择续约
```

## 4.6 路由协议

***有常见的路由协议, 各自使用什么算法实现?***

```
RIP(内部路由协议): 路由表中包含距离向量, 距离=16认为不可达, 适用于小型LAN
OSPF(内部路由协议): 直接保存网络拓扑图, 使用单源最短路径算法(Dijjstra算法)
```

# 6. 链路层介绍

## 6.1 以太网

***什么是以太网?***

```
物理层一般为电缆/光纤组成的有线链路, 使用以太网协议的网络称为以太网
```

***CSMA/CD协议是什么?***

往链路发送数据帧前, 需要进行碰撞检测, 如果

```
CSMA/CD协议:
发送数据帧前先检测信道是否为空闲, 如空闲则开始发送

发送过程中如果检测到冲突则立刻停止发送并在随机延迟后再次尝试发送
```

![1690962743014](image/计算机网络/1690962743014.png)


## 6.2 无线局域网(WLAN)

***无线局域网CSMA/CA协议?***

```
CSMA/CA: 发送数据帧前需要链路空闲一段时间, 同时要先发送一个握手数据帧到链路上所有节点, 等待链路上节点回复后再发送(让其他节点知道链路已经被占用)
```

## 6.3 VLAN & VPN

***什么是虚拟局域网(VLAN)?***

每个局域网设备被分配一个VID, **通过交换机分隔不同VID之间的广播域**实现虚拟局域网

![1690963002084](image/计算机网络/1690963002084.png)

***什么是虚拟私有网络VPN?***

```
VPN指 通过加密协议对数据包进行加密, 然后使用公共网络发送数据包到私有网络, 私有网络内解密获取原本的数据报, 从而实现通过公共网络访问私有网络资源的目的
```

![1690963893414](image/计算机网络/1690963893414.png)

# 7. 网络安全

***常见的网络攻击有哪些? 攻击原理是什么?***

```
* 注入攻击(XSS注入, SQL注入, OS注入): 程序没有对用户的输入进行检查, 导致往html页面/sql语句/操作系统指令中注入了恶意代码或指令

* CSRF攻击: 盗取用户的登录状态的cookie伪造用户访问网站

* 域名污染: 攻击DNS服务器, 使得DNS解析到错误的IP或伪造的IP

* DDOS攻击: 利用大量分布式的请求同时发送到被攻击主机, 主机响应这些请求导致无法响应正常的请求
```

***什么是Cros问题, 如何解决?***

```
* 浏览器默认只允许使用JS脚本向同域名同端口下进行ajax请求
* 如果想跨域, 浏览器会先发送OPTIONS请求到服务器询问服务器的跨域信息, 再根据跨域信息决定是否发送跨域请求
```

***什么是CSRF攻击, 如何防范?***

```
在第三方网站上点击了<from action="www.bank.com">, 浏览器会向该网站发送请求并携带cookie!!!
当cookie中包含身份信息时, 用户账号被盗用

防范方式:
* 服务器在收到请求时检查请求头中的Origin/Refer字段
* 不使用cookie保存身份信息, 使用token, token不保存在cookie中
```


***常见的DDOS攻击有哪些, 有什么方法防范吗?***

```
常见的DDOS攻击:  SYN泛洪(TCP半连接), ICMP泛洪(ping), 带宽泛洪

防范方式: 负载均衡, CDN, 分布式缓存, 防火墙设置IP黑名单
```
