# 1. 计算机网络理论

## 1.1 网络模型

_**讲一下网络的 OSI 七层模型和 TCP/IP 五层模型?**_

```
🌟 应用层(Application Layer): 应用到应用
* (表现层)
* (会话层)
🌟 传输层(Transport Layer): 进程到进程
🌟 网络层(Network Layer): 终端到终端
🌟 链路层(Link Layer): 网络节点到网络节点
🌟 物理层: 物理信号到Bit
```

_**每一层常见的协议有哪些?**_

```
应用层: HTTP FTP DNS SSH(安全Shell协议) SMTP(简单邮件传输协议)
传输层: TCP UDP
网络层: IP ICMP(网络探测协议)
链路层: ARP(地址解析协议)
```

## 1.2 术语

_**为什么有MAC地址还要有IP地址, 可以只用MAC地址/IP地址吗?**_

```
🌟 IP地址分为网络号和主机号, 适合路由, 但不适应设备地理迁移(路由表更新慢)
🌟 MAC地址是UUID, 不适合用于路由(路由表过大), 但适应设备地理迁移

🌙 形象的比喻: MAC相当于身份证号, IP相当于家庭地址, 邮寄信件不能根据身份证号邮寄, 但如果只用家庭地址邮寄
🌙 如果只使用MAC地址, 无法路由, 如果只使用IP地址, 设备无法地理迁移
```

_**带宽(bandwidth)、吞吐量(throughput)、网速(speed)、延迟(latency)的区别?**_

```
🌟 吞吐量 = 实际网络传输速度(单位时间传输的数据量)
🌟 带宽 = 吞吐量的理论最大值
🌟 实时网速=吞吐量, 最大网速=带宽, 其中实时网速又细分为实时上传网速+实时下载网速
🌟 延迟 = 端到端的传输时间间隔
```

_**为什么 ISP 宣称的 200Mbps 宽带实际网速才 3MiB/s?**_

```
Mbps的M全称为Mega, 遵循10进制, MiB/s中的M全称为Mebi, 遵循2进制

🌙 200Mbps = 25MBps = 2.98MiB/s
```

_**网卡和中继器的作用?**_
```
🌟 网卡: 负责链路层的数据发送和接收, 每个网卡有唯一的MAC地址
🌟 中继器/集线器: 负责放大物理信号
```

_**什么是VLAN(虚拟局域网)?**_

```
VLAN: 交换机通过端口的VID从逻辑上划分了广播域, 从而使得一个VID下的设备逻辑上在同一个局域网中
```

_**交换机和路由器是如何实现转发数据包的?**_

```
🌟 交换机通过ARP广播报文学习端口<=>MAC地址的映射表
🌟 路由器通过路由协议(如RIP报文)学习IP地址<=>路由端口的路由表
```

_**什么是 CDN 加速?**_

```
CDN全称Content Delivery Networks, 在网络边缘搭建CDN服务器同步源站的静态资源, 客户端直接访问CDN服务器

🌙 客户端访问不存在的资源时CDN服务器会主动从源站拉取数据, 源站也能主动Push资源到CDN服务器
🌙 CDN依赖DNS系统, 当访问同一个源站域名时, 依赖DNS解析成不同的CDN服务器ip
```

# 2. 应用层协议

## 2.1 HTTP/1.1

_**URL和URI的区别?**_

```
URL特指网络上资源的标识符, URI是URL的超集
```

_**讲一下http请求报文格式?**_
```
GET /index.html?a=1&b=2 HTTP/1.1         ---请求行 = 请求方法 + 请求路径 + 协议版本号
HOST: www.example.com                    ---请求头
User-Agent: Mozilla/5.0

{age: 18, name: 'jerry'}                 ---请求体
```

_**讲一下http响应报文格式?**_
```
HTTP/1.1 200 OK                ---响应行 = 响应码 + 响应描述 + 协议版本号
Content-Type: text/html        ---响应头
Content-Length: 3373

{msg: 'success'}               ---响应体
```

_**讲一下HTTP常见的请求方法?**_
```
GET: 获取服务器资源 (幂等操作)
POST: 修改服务器资源 (非幂等操作)
OPTIONS: 询问Web服务器的配置

🌙 按照约定GET方法请求中只允许使用query参数, 不允许使用body参数, 但协议层面没有强卡
```

_**讲一下HTTP常见的响应码?**_
```
200: OK
301:永久重定向 302:临时重定向
400:请求报文格式错误 401:未认证 403:无权限 404:资源不存在 405:请求方法不允许
500:服务器内部错误
```

_**什么是幂等性?**_

```
幂等性: 指多次重复请求不会对服务器产生副作用

🌙 HTTP协议规定GET需要遵循幂等性
```

_**什么是`HTTP`长连接?**_

```
Htpp/1.1 请求头中可以使用"keep-alive", 多个http请求使用一个TCP连接(以管道的方式复用TCP连接)
```

_**Cookie 主要的组成部分有哪些？**_

```
Cookie的组成部分包括:
🌟key
🌟value
🌟domain & path: 生效的域名和路径
🌟expire: 过期时间

🌙 HTTP协议本身为无状态协议, 但可以通过Cookie记录会话状态, 发起HTTP请求时会携带, 格式为:"Cookie: name=value; name2=value2; name3=value3"
🌙 一般的做法是: 前端在发送请求时会携带name="JSESSIONID"的Cookie, 后端通过JSESSIONID从数据库中获取Session对象实现会话管理
🌙 HTTP响应头中可以通过"Set-Cookie"设置Cookie
```

_**Jwt(Json Web Token)的由哪三部分组成?**_
```
🌟header: 包含加密算法等元信息
🌟payload: 用户信息
🌟signature: 数字签名

🌙 企业开发中一般使用Token做登录态控制, Token放在Cookie中"token=xxx"
🌙 不一定使用JWT作为Token(可能是其他协议的Token), 但Token都有数字签名, 并且在用户登录成功后下发Token
```

## 2.2 HTTP 2/3

**_Http/2.0 相较于 Http/1.1 有哪些改进?_**
```
🌟 使用多路复用解决http长连接中的队头阻塞问题
🌟 使用压缩算法对请求头进行压缩
🌟 支持服务器主动推送资源
```

**_Http3.0 特点?_**
```
HTTP3.0传输层使用QUIC协议(QUIC协议集TCP TLS UDP协议优点于一身)
```

## 2.3 HTTPS

_**常见的加密算法有哪些?**_

```
🌟 HASH算法: MD5 SHA
🌟 对称加密算法: AES
🌟 非对称加密算法: RSA

🌙 严格意义上来说, Hash算法不能算作加密算法, 因为不可还原(理论上, 因为信息熵更高了)
🌙 一般来说, 对称加密算法在通过密文解析原文时, 性能远远高于非对称加密算法
```

**_可以通过大量"明文-密文"对反向破解出 AES 的密钥吗?_**
```
很难, AES加密算法可以抵御明文攻击(KPA)
```

_**什么是加盐加密?**_

```
存储密码时, 生成随机字符串作为salt, 将密码和salt拼接后再hash, DB中保存salt和hash值

🌙 理论上不应该将用户的密码明文存储到DB中, 只存储加盐后的Hash值也能校验用户输入是否正确
🌙 加盐的目的是防止通过hash和已知密码反向破解出可能的密码值
```

_**数字证书和数字签名的区别?**_

```
🌟 数字签名: 指对文档的hash值使用私钥加密得到的密文, 使用公钥可以还原密文进行验证
🌟 数字证书: CA机构颁发的带数字签名的证书, 包含服务器TLS握手需要的公钥
```

_**讲一下 `SSL/TLS`协议握手过程?**_
```
1️⃣ 客户端请求服务器, 服务器下发TLS协议套件和证书, 并交换随机数
2️⃣ 客户端通过证书上的数字签名验证证书有效, 使用证书上的公钥加密通信过程3️⃣中的Pre-Master-Key
3️⃣ 客户端随机生成Pre-Master-Key, 发送给服务器
4️⃣ 服务器通过Pre-Master-Key和1️⃣交换的随机数算出Master-Key, 服务器和客户端后续使用Master-Key进行对称加密通信

🌙 由于CA证书过期导致的线上事故很多, 需要注意即时续期
```

## 2.4 WebSocket

**_什么是 WebSocket 协议?_**

```
基于TCP的全双工应用层协议

🌙 WebSocket协议常用于在线聊天/在线文档/在线游戏的场景, 服务器可主动推送消息到客户端
```

**_WebSocket 协议握手过程?_**

```
1️⃣ 客户端发送HTTP报文, 请求头中包含Upgrade: WebSocket
2️⃣ 服务端返回HTTP报文, 响应码为101, 握手完成
```

# 3. 传输层协议

## 3.1 TCP/UDP

**_为什么TCP使用四元组唯一确定一个链接而UDP只使用二元组?_**
```
🌟 TCP面向连接, 所以使用<源IP, 源端口, 目标IP, 目标端口>标识一个TCP连接
🌟 UDP只需要确认接收方, 使用<目标IP, 目标端口>二元组
```

**_说一下常见的端口号对应的哪些应用?_**

```
20/21: FTP
53: DNS
80: HTTP
443: HTTPS
3306: MYSQL
```

**_可以在一个端口上同时进行 TCP 通信和 UDP 通信吗?_**
```
可以, 操作系统会将TCP报文和UDP报文交给不同的模块处理
```

## 3.2 可靠通信服务

**_TCP依靠什么提供可靠通信服务(TCP算法特性)?_**

```
🌟 滑动窗口和流量控制
🌟 超时重传和重排序
🌟 拥塞控制算法
```

**_什么是快重传算法?_**

```
发送方的滑动窗口中的报文会并行发送, 确认接收成功后会移动窗口

🌙 如果发送方如果重复3次收到一个ACK, 会立刻重传该SEQ的报文(认为报文已经丢失), 这就是快重传
```

**_讲一下 TCP 的拥塞控制算法?_**

```
发送方的滑动窗口的大小 = min(接收方设定的cwnd, 拥塞窗口)

🌙 拥塞窗口在没有拥塞时指数级增长(快启动), 达到阈值后线性增长, 出现拥塞时更新阈值并重新开始快启动
```

**_什么是 nagle 算法?_**
```
操作系统内核在发送TCP报文时, 如果单个报文过小, 会先放入缓冲区, 合并为大报文再发送

🌙 nagle算法默认开启
```

**_什么是 TCP 粘包和拆包问题?_**

```
TCP是面向字节流的协议:
🌟 如果发送方写入的数据大于Socket缓冲区大小或MSS, 会发生拆包, 导致应用层消息被拆分成两个TCP报文
🌟 如果nagle算法生效或Socket缓冲区积累过多, 会导致粘包

🌙 只有基于Socket的网络编程时需要处理粘包/拆包问题, 例如Netty编程
```

## 3.3 TCP 连接

**_TCP 连接建立和释放过程?_**

三次握手

```
1️⃣ 客户端 => SYN
2️⃣ SYN + ACK <= 服务端
3️⃣ 客户端 => ACK
```

***讲一下四次挥手过程?***
```
1️⃣ 客户端 => FIN
2️⃣ ACK <= 服务器(CLOSE_WAIT)
3️⃣ FIN <= 服务器
4️⃣ 客户端(TIME_WAIT) => ACK
```

**_为什么需要三次握手而不是两次/四次?_**

```
🌟 两次握手: 如果客户端先后发送两次SYN(旧的SYN因网络延迟未被ACK), 旧的SYN会导致服务器资源浪费
🌟 四次握手: 没必要, 三次握手已经能保证双方资源就绪
```

**_为什么挥手TIME_WAIT时客户端需要等待2MSL(最大报文生存时间)后才正式关闭连接?_**
```
防止发送的ACK报文丢失, 如果服务器重新发送FIN报文, 间隔时间最多为2MSL
```

# 4. 网络层协议

## 4.1 IP 协议

**_IP地址是如何分类的(分类寻址)?_**

```
🌟 A类: 0.X.X.X ~ 127.X.X.X (依据前1个byte进行路由)
🌟 B类: 128.0.X.X ~ 191.255.X.X (依据前2个byte进行路由)
🌟 C类: 192.X.X.X ~ 223.X.X.X (依据前3个byte进行路由)
🌟 D类为多播地址, E类未使用

🌙 IP地址分类最开始是便于根据机构大小直接分配特定前缀的网段IP(例如某大企业使用128.11.X.X网段, 128.11作为网络号), 现已弃用!!!
🌙 路由器可以直接通过IP前缀快速路由
```


**_为什么要区分网络号?_**
```
网络号用于路由器和本地主机的路由策略, 例如:

本地主机发送IP报文, 发现自己的IP和目标IP在同一个网络号下, 直接通过ARP获取目标MAC地址然后直接通过交换机发送
```

***什么是CIDR?***
```
采用前缀的位数标记网络号长度, 例如192.168.1.1/24, 表示前24位为网络号

🌙 子网掩码就是CIDR的一种形式, 用于标记子网的网络号长度
```

**_私有网络IP地址(局域网IP地址)的范围是多少?_**

```
🌟 10.X.X.X
🌟 172.16.X.X ~ 172.31.X.X
🌟 192.168.X.X
```

**_什么是NAT技术?_**
```
私有网络中的主机使用私有IP地址, 私网中的主机复用一组公网IP地址, 由NAT路由器完成私有IP到公有IP的映射

🌙 NAT技术是为了解决公网IPv4地址不够用的问题, 常见于家庭局域网
```

## 4.2 DNS

**_域名解析为IP地址的过程?_**

```
1️⃣ 先查询本地DNS缓存
2️⃣ 查询顶级域名服务器, 获取次级DNS服务器IP
3️⃣ 重复上述过程, 最底层DNS服务器返回解析到的IP

🌙 DNS服务器本身呈树状拓扑, 是一个典型的分布式系统, 一般来说次级域名服务器对应一个后缀(如.com对应一个次级服务器, .cn对应另一个次级服务器)
```

**_域名记录的类型常见的有哪些?_**
```
🌟 A记录类型: 域名 -> IP
🌟 CNAME记录类型: 域名别名 -> 域名
🌟 邮件域名 -> 邮件服务器IP
```
## 4.3 ARP/ICMP/DHCP

**_ARP协议是什么?_**
```
ARP协议通过广播报文的方式, 将局域网内的IP地址解析为MAC地址, 过程如下:

1️⃣广播ARP请求报文(包含发送方MAC地址和请求的IP地址)
2️⃣对应IP地址的主机接受到报文后向请求方发送自己的IP地址和MAC地址
```

**_ICMP协议是什么?_**

```
ICMP协议用于网络诊断和监测, 常见的应用场景为:

🌟 traceroute: 收到TTL=0的报文后的路由器响应ICMP报文
🌟 ping: 回送ICMP报文

🌙 traceroute可以找到网络链路上的所有路由节点, ping可以测试网络连通性和延迟
```

**_DHCP协议是什么?_**

```
DHCP服务器在支持主机连接到局域网后, 自动给主机进行网络配置, 过程如下:
1️⃣客户端广播DHCP发现报文
2️⃣DHCP服务端返回可用配置集合(IP/子网掩码/默认网关IP)
3️⃣客户端发送被选择的配置
4️⃣客户端定期续约
```

## 4.4 路由协议

**_有常见的内部路由协议?_**
```
路由协议的目的是为了让路由器自动学习路由到特定网络的路径, 常见的协议有:

🌙 RIP: 路由表中保存 (IP <=> 距离)表, 距离=16认为不可达, 只适用于小型局域网
🌙 OSPF: 直接保存网络拓扑图, 使用单源最短路径算法路由

🌙 内部路由协议用于一个自治系统(如ISP网络)内路由器的学习, 外部路由协议用于多个资质系统出口路由器的学习
```

## 4.5 VPN

**_什么是虚拟私有网络VPN?_**
```
两个私有网络之间通过公共网络链接, 但加密通信过程从而实现一个私有网络的效果

🌙 加密/解密过程可以通过两个私有网络的边界路由器实现
🌙 除了两个私有网络之间的VPN, 也可以将一个设备和一个私有网络之间进行VPN链接, 设备需要走网络代理, 代理软件负责加密/解密
```

# 6. 链路层介绍

## 6.1 以太网

**_什么是以太网(Ethernet)?_**

```
物理实现一般为电缆/光纤, 链路层使用以太网协议的网络称为以太网
```

**_CSMA/CD 和 CSMA/CA 协议的区别?_**

```
🌟 CSMA/CD=碰撞检测算法: 发送消息时检测到信道有噪音(判断出有其他设备开始发送消息)则延迟随机发送(允许碰撞)

🌟 CSMA/CA=碰撞避免算法: 发送消息前需要告知信道上所有设备"信道已被占用", 避免碰撞

🌙 CSMA/CA适合无线网络等自然噪音较大的网络
```


# 7. 网络安全

_**什么是 XSS 注入和 SQL 注入?**_

```
XSS注入: 用户输入的内容被解析为了HTML页面的DOM元素

SQL注入: 用户输入的查询条件破坏了原本的SQL语法结构
```

_**什么是 CROS 标准?**_

```
CROS标准: 使用XHR对象发起跨域请求时, 浏览器会先向跨域服务器发送OPTIONS请求询问服务器的跨域策略, 如果服务器允许跨域才发送真正的请求

🌙 跨域请求指在a.com网页中向b.com发送请求
🌙 使用<a><img>等标签可以绕过同源策略, 用nginx等代理服务器也可以绕过同源策略
🌙 浏览器默认拦截跨域请求(除非跨域服务器配置了允许跨域), 原因在于跨域请求会携带跨域cookie, 可能导致身份盗用(CSRF攻击)
```

_**常见的DDOS攻击有哪些?**_

```
常见的DDOS(Distributed Denial of Service)攻击有:
🌟 SYN泛洪(TCP半连接)
🌟 ICMP泛洪(ping)
🌟 网络泛洪

🌙 一般防范方式有: 负载均衡, CDN加速, 放火墙(或其他流量清洗手段)
🌙 DDOS问题难以根治, 因为难以100%准确区分正常流量与恶意流量(如病毒会绑架正常用户的主机进行DDOS攻击)
```
